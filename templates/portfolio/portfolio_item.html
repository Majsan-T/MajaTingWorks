{% extends 'base.html' %}

{% block title %}{{ item.title }}{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <!-- Vänster kolumn -->
    <div class="col-md-8">
      <h1 class="mb-3">{{ item.title }}</h1>
      <p class="text-muted mb-4">
        <strong>Kategori:</strong>
        {% if item.category_obj %}
          {{ item.category_obj.title }}
        {% else %}
          Ingen kategori
        {% endif %}
      </p>

      {# Bild: använd inläggsbild, annars kategori-bild, annars fallback #}
      {% set fallback_image = 'assets/img/default_portfolio.webp' %}
      {% set category_image = item.category_obj.image if item.category_obj and item.category_obj.image else fallback_image %}
      {% if item.image %}
        <div class="overflow-hidden rounded mb-4" style="max-height: 400px;">
          <img
            src="{{ url_for('static', filename='uploads/portfolio/' ~ item.image) }}"
            class="w-100 object-fit-cover"
            alt="{{ item.title }}"
          >
        </div>
      {% else %}
        <div class="overflow-hidden rounded mb-4" style="max-height: 400px;">
          <img
            src="{{ url_for('static', filename=category_image) }}"
            class="w-100 object-fit-cover"
            alt="{{ item.category_obj.title if item.category_obj else 'Ingen kategori' }}"
          >
        </div>
      {% endif %}

      <div class="content mb-4">
        {{ item.description | safe }}
      </div>

      <!-- Navigering: Föregående / Nästa -->
      <div class="d-flex justify-content-between my-4">
        {% if prev_item %}
          <a href="{{ url_for('portfolio.show_portfolio_item', item_id=prev_item.id) }}"
             class="btn btn-outline-secondary btn-sm">
            ← {{ prev_item.title[:30] }}{% if prev_item.title|length>30 %}…{% endif %}
          </a>
        {% else %}
          <span></span>
        {% endif %}

        {% if next_item %}
          <a href="{{ url_for('portfolio.show_portfolio_item', item_id=next_item.id) }}"
             class="btn btn-outline-secondary btn-sm">
            {{ next_item.title[:30] }}{% if next_item.title|length>30 %}…{% endif %} →
          </a>
        {% endif %}
      </div>

      <a href="{{ url_for('portfolio.index') }}" class="btn btn-outline-primary btn-sm">
        ← Tillbaka till portfolio
      </a>
    </div>

    <!-- Höger kolumn: Senaste projekt -->
    <div class="col-lg-4">
      <h5 class="mb-3">Senaste projekt</h5>
      <div class="d-flex flex-column gap-3">
        {% for post in posts %}
        <div class="card shadow-sm
                    {% if post.id == item.id %}border-primary bg-light{% endif %}">
          <div class="row g-0">
            <div class="col-4">
              {% set fallback = 'assets/img/default_portfolio.webp' %}
              <img
                src="{{ url_for('static', filename='uploads/portfolio/' ~ post.image) if post.image and post.image.strip() else url_for('static', filename=fallback) }}"
                onerror="this.onerror=null; this.src='{{ url_for('static', filename=fallback) }}';"
                class="object-fit-cover w-100"
                style="height:100px"
                alt="{{ post.title }}"
              >
            </div>
            <div class="col-8">
              <div class="card-body p-2">
                {% if post.id == item.id %}
                  <h6 class="card-title mb-1 text-primary">
                    {{ post.title[:50] }}{% if post.title|length>50 %}…{% endif %}
                  </h6>
                {% else %}
                  <a
                    href="{{ url_for('portfolio.show_portfolio_item', item_id=post.id) }}"
                    class="text-decoration-none text-dark"
                  >
                    <h6 class="card-title mb-1">
                      {{ post.title[:50] }}{% if post.title|length>50 %}…{% endif %}
                    </h6>
                  </a>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      {% if total_pages > 1 %}
      <nav aria-label="Sidor">
        <ul class="pagination justify-content-center mt-3">
          <li class="page-item {% if page == 1 %}disabled{% endif %}">
            <a
              class="page-link"
              href="{{ url_for('portfolio.show_portfolio_item', item_id=item.id, page=page-1) }}"
            ><i class="bi bi-chevron-left"></i></a>
          </li>
          {% for i in range(1, total_pages + 1) %}
            <li class="page-item {% if page == i %}active{% endif %}">
              <a
                class="page-link"
                href="{{ url_for('portfolio.show_portfolio_item', item_id=item.id, page=i) }}"
              >{{ i }}</a>
            </li>
          {% endfor %}
          <li class="page-item {% if page == total_pages %}disabled{% endif %}">
            <a
              class="page-link"
              href="{{ url_for('portfolio.show_portfolio_item', item_id=item.id, page=page+1) }}"
            ><i class="bi bi-chevron-right"></i></a>
          </li>
        </ul>
      </nav>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
